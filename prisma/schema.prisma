generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Member {
  discordUserId        String        @id
  status               MemberStatus  @default(LAOBAN)
  balance              Decimal       @default(0) @db.Decimal(19, 4)
  totalSpent           Decimal       @default(0) @db.Decimal(19, 4)
  commissionRate       Decimal       @default(0.75) @db.Decimal(7, 6)
  commissionFrom       Commission[]  @relation("CommissionFrom")
  commissionTo         Commission[]  @relation("CommissionTo")
  sentTransactions     Transaction[] @relation("FromMember")
  receivedTransactions Transaction[] @relation("ToMember")
}

model Transaction {
  Transid    String      @id @default(cuid())
  fromId     String
  toId       String
  amount     Decimal     @db.Decimal(19, 4)
  feeAmount  Decimal     @db.Decimal(19, 4)
  netAmount  Decimal     @db.Decimal(19, 4)
  createdAt  DateTime    @default(now())
  commission Commission?
  from       Member      @relation("FromMember", fields: [fromId], references: [discordUserId])
  to         Member      @relation("ToMember", fields: [toId], references: [discordUserId])
}

model Commission {
  transactionId String      @id
  fromId        String
  toId          String
  feeAmount     Decimal     @db.Decimal(19, 4)
  createdAt     DateTime    @default(now())
  from          Member      @relation("CommissionFrom", fields: [fromId], references: [discordUserId])
  to            Member      @relation("CommissionTo", fields: [toId], references: [discordUserId])
  transaction   Transaction @relation(fields: [transactionId], references: [Transid], onDelete: Cascade)
}

model InteractionLog {
  Interid   String   @id @default(cuid())
  memberId  String?
  command   String?
  payload   Json?
  createdAt DateTime @default(now())
}

model Gift {
  GiftName String  @id
  price    Decimal @default(0) @db.Decimal(19, 4)
  url_link String?
}

enum MemberStatus {
  LAOBAN
  PEIWAN
}

enum EntryKind {
  DIANDAN
  DASHANG
  TIXIAN
  RECHARGE
}
